<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Wikipedia objects</title>
  <script src="js/jquery-2.2.1.min.js"></script>
</head>
<body>
 
<pre id='json' style='white-space: pre-wrap'></pre>
 
<script>


(function() {

	/*

	==========
	wikipedia

	-> all the sections within an article
	https://en.wikipedia.org/w/api.php?action=parse&page=annecy&prop=sections

	-> parsed text + internal links within a specific section
	https://en.wikipedia.org/w/api.php?action=parse&page=annecy&prop=links|text&section=0

	https://en.wikipedia.org/w/api.php?action=parse&page=Annecy&prop=text&section=0

	-> all the external links within an article
	https://en.wikipedia.org/w/api.php?action=parse&page=annecy&prop=externallinks

	-> get the wikibase_item of an article
	https://en.wikipedia.org/w/api.php?action=query&prop=pageprops&ppprop=wikibase_item&titles=Annecy
	https://en.wikipedia.org/w/api.php?action=query&prop=pageprops&ppprop=wikibase_item&titles=Annecy&formatversion=2


	==========
	wikidata

	-> get the statements from an item
	https://www.wikidata.org/w/api.php?action=wbgetclaims&format=xml&props=value&entity=Q50189


	-> get the labels of a series of article in English and French
	https://www.wikidata.org/w/api.php?action=wbgetentities&props=labels&format=xml&languages=en|fr&ids=Q50189|Q544|Q3241540|Q185969|Q715269|Q27527


	-> the description of a property
	https://www.wikidata.org/wiki/Property:P214
	

	-> querying if Annecy (Q50189) has the country property (P17)
	https://www.wikidata.org/w/api.php?action=wbgetclaims&entity=Q50189&property=P17 


	-> freebase identifier
	https://www.wikidata.org/wiki/Property:P646
	https://www.freebase.com/m/02jsr9
	

	*/


	function WikiObj(){
		this.sections;
		this.links = new Array();
		this.sectionNumber;

		this.lang = "en"
		this.article = "Annecy"
	}
	

	// https://en.wikipedia.org/w/api.php?action=parse&page=annecy&prop=sections


	WikiObj.prototype.generateDataObj = function(){
		this.getHeadings();
	}


	WikiObj.prototype.getHeadings = function(){

		var WObj = this
		// console.log(WObj);

		$.getJSON('http://'+WObj.lang+'.wikipedia.org/w/api.php?action=parse&format=json&callback=?', {
			page:WObj.article, 
			prop:'sections'
		})
			.done(function(result){


				WObj.sections = new Array();

				// $('#json').text(JSON.stringify(result, '', 2));

				// retrieving only the section list
				var sections_in_article = result.parse.sections

				WObj.sectionNumber = result.parse.sections.length

				// iterating through the sections
				for(var section in sections_in_article){
					
					// console.log(sections_in_article[i])

					WObj.sections.push(sections_in_article[section].line)
				}

				console.log(WObj.sections); 
				console.log(WObj.sectionNumber); 

				WObj.getInteralLinks();
			});
	
	};


	WikiObj.prototype.getInteralLinks = function(){

		var WObj = this
		console.log(WObj);
		console.log(WObj.sectionNumber);



		query_internal_links_in_section = function(sectionRef){

			console.log('Querying links from section '+sectionRef)

			$.getJSON('http://'+WObj.lang+'.wikipedia.org/w/api.php?action=parse&format=json&callback=?', {
				page:WObj.article, 
				prop:'links',
				section: sectionRef
			})

			.done(function(result){

				console.log(result);

				

				var links_in_section = result.parse.links

				for(var link in links_in_section){
						
					console.log(links_in_section[link])

					// WObj.sections.push(sections_in_article[section].line)
				}

			});
		};


		var currentSection = 0;
		var sectionsTotal = WObj.sectionNumber

		if(currentSection < sectionsTotal - 1){
			query_internal_links_in_section(currentSection);
			currentSection++;

		}else{
			console.log("ende");

			


		}



	};


var wikiObj1 = new WikiObj();

wikiObj1.generateDataObj();

})();
</script>
 
</body>
</html>


